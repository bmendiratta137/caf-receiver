<html>
<head>
    <script type="text/javascript" src="agent.js"></script>

    <!-- New Relic Video -->
    <script src="../dist/newrelic-caf.min.js"></script>

    <!-- CAF Receiver SDK -->
    <script src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
    <title>Cast Videos: Google Cast Chrome Sender SDK Demo App</title>
    <link rel="icon" type="image/x-icon" href="imagefiles/favicon.ico" />
    <link rel="icon" type="image/png" href="imagefiles/favicon-16x16.png" />
    <link rel="icon" type="image/png" href="imagefiles/favicon-32x32.png" />
    <link rel="icon" type="image/png" href="imagefiles/favicon-64x64.png" />
    <link rel="stylesheet" type="text/css" href="css/CastVideos.css">
    <link href='//fonts.googleapis.com/css?family=Roboto&subset=latin,cyrillic-ext,greek-ext,latin-ext' rel='stylesheet'
      type='text/css'>
</head>
<body>
    <!-- <cast-media-player></cast-media-player> -->
    <div id="top_header">
        <div id="logo"></div>
      </div>
      <div id="main_video">
        <div class="imageSub">
          <!-- Put Your Image Width -->
          <div class="blackbg" id="playerstatebg">IDLE</div>
          <div class=label id="playerstate">IDLE</div>
          <img src="imagefiles/bunny.jpg" id="video_image">
          <div id="video_image_overlay"></div>
          <video id="video_element">
          </video>
        </div>
    
        <div id="skip">Skip Ad</div>
    
        <div id="media_control">
          <div id="play"></div>
          <div id="pause"></div>
          <div id="audio_bg"></div>
          <div id="audio_bg_track"></div>
          <div id="audio_indicator"></div>
          <div id="audio_bg_level"></div>
          <div id="audio_on"></div>
          <div id="audio_off"></div>
          <div id="progress_bar_container">
            <div id="progress_bg"></div>
            <div id="seekable_window"></div>
            <div id="progress"></div>
            <div id="unseekable_overlay"></div>
            <div id="progress_indicator"></div>
          </div>
          <div id="fullscreen_expand"></div>
          <div id="fullscreen_collapse"></div>
          <google-cast-launcher id="castbutton"></google-cast-launcher>
          <div id="currentTime">00:00:00</div>
          <div id="duration">00:00:00</div>
          <img id="live_indicator">
        </div>
      </div>
      <div id="media_info">
        <div id="media_title"></div>
        <div id="feature_toggle_container">
          <input type="radio" id="none" name="feature" value="none" checked>None<br>
          <input type="radio" id="ads" name="feature" value="ads">Ads<br>
          <input type="radio" id="live" name="feature" value="live">Live
        </div>
        <div id="media_subtitle"></div>
      </div>
    
      <div id="carousel"></div>
    
      <div id="footer">
        <div id="copyright">Copyright 2021 Google LLC. All Rights reserved.</div>
        <div id="footer_content">Visit the <a id="footer_content_link" href="https://developers.google.com/cast/">Google
            Cast Developer Site</a></div>
        <div id="footer_language">Language English</div>
      </div>
    
      <script src="CastVideos.js" type="module"></script>
      <script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
    <script>

        // Capture JS errors
        window.onerror = function (msg, url, line) {
            console.log("Message : " + msg );
            console.log("url : " + url );
            console.log("Line number : " + line );
            newrelic.addPageAction("JSError", {"errMessage": msg, "errUrl": url, "errLine": line})
        }

        cast.framework.CastReceiverContext.getInstance().start();
        cast.framework.CastReceiverContext.getInstance().setLoggerLevel(cast.framework.LoggerLevel.DEBUG);

        // Set logging level (show all messages)
        nrvideo.Log.level = nrvideo.Log.Levels.ALL;

        // Config New Relic Insights backend
        nrvideo.Core.setBackend(new nrvideo.NRInsightsBackend("11649900", "NRBR-35ebbb76d3c71605795"));
        
        // Init CAF Tracker
        nrvideo.Core.addTracker(new nrvideo.CAFTracker());

        let playerManager = cast.framework.CastReceiverContext.getInstance().getPlayerManager();
        playerManager.setMessageInterceptor(cast.framework.messages.MessageType.LOAD, request => {
            console.log("Intercepting LOAD request");
            
            const vmapUrl = "https://pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=/124319096/external/ad_rule_samples&ciu_szs=300x250&ad_rule=1&impl=s&gdfp_req=1&env=vp&output=vmap&unviewed_position_start=1&cust_params=deployment%3Ddevsite%26sample_ar%3Dpremidpost&cmsid=496&vid=short_onecue&correlator=" + Math.floor(Math.random() * Math.pow(10, 10));

            request.media.vmapAdsRequest = {
                adTagUrl: vmapUrl,
            };

            return request;
        });

    </script>
</body>
</html>
